<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ìˆ˜ì‹œ ìµœì € í•„í„°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    /* ë””ìì¸ ì‹œìŠ¤í…œ */
    :root { --primary: #007aff; --primary-dark: #0056b3; --bg: #f4f6f9; --star: #ffcc00; --danger: #ff4d4f; --text: #333; }
    body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background: var(--bg); margin: 0; padding: 40px 20px; color: var(--text); line-height: 1.5; }
    .container { max-width: 800px; margin: 0 auto; padding-bottom: 80px; }
    
    h1 { text-align: center; color: var(--text); margin: 0 0 8px 0; font-size: 36px; letter-spacing: -1px; font-weight: 800; word-break: keep-all; }
    .subtitle { text-align: center; color: #666; font-size: 16px; margin-bottom: 40px; font-weight: 500; opacity: 0.8; word-break: keep-all; }
    
    .upload-box { background: #fff; padding: 40px; border-radius: 20px; text-align: center; margin-bottom: 24px; border: 2px dashed #dde2e6; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.02); }
    .upload-box.ready { border-color: var(--primary); background: #f0f7ff; }
    
    .input-box { background: white; padding: 30px; border-radius: 20px; margin-bottom: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); opacity: 0.6; pointer-events: none; transition: 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); filter: grayscale(100%); }
    .input-box.active { opacity: 1; pointer-events: auto; filter: grayscale(0%); transform: translateY(0); }

    .row { display: flex; gap: 12px; margin-bottom: 16px; align-items: center; }
    .row label { width: 50px; font-weight: 700; font-size: 16px; color: #495057; white-space: nowrap;}
    input, select { flex: 1; padding: 14px; border: 1px solid #dee2e6; border-radius: 12px; font-size: 16px; transition: 0.2s; outline: none; -webkit-appearance: none; }
    input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
    
    .btn-search { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 18px; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.2s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
    .btn-search:disabled { background: #ced4da; cursor: not-allowed; box-shadow: none; }
    
    .filter-bar { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; -ms-overflow-style: none; }
    .filter-bar::-webkit-scrollbar { display: none; } /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
    
    .filter-btn { padding: 8px 16px; border: 1px solid #e9ecef; border-radius: 50px; background: white; cursor: pointer; font-weight: 600; color: #495057; white-space: nowrap; transition: 0.2s; font-size: 14px; flex-shrink: 0; }
    .filter-btn.active { background: #343a40; color: white; border-color: #343a40; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

    .card { background: white; padding: 24px; border-radius: 16px; margin-bottom: 16px; border-left: 6px solid #dee2e6; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative; transition: all 0.3s ease; }
    
    .card.dimmed { opacity: 0.6; background-color: #f9f9f9; border-left-color: #ced4da !important; filter: grayscale(50%); }
    .card.dimmed .badge.bg-green { display: none; } 
    .fail-msg { color: var(--danger); font-weight: 800; font-size: 12px; display: none; background: #fff5f5; padding: 4px 8px; border-radius: 6px; }
    .card.dimmed .fail-msg { display: inline-block; margin-left: 5px; }

    .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
    .star-btn { font-size: 26px; color: #dee2e6; cursor: pointer; padding: 5px; line-height: 1; }
    .star-btn.active { color: var(--star); text-shadow: 0 2px 10px rgba(255, 204, 0, 0.4); }

    .badge { display: inline-block; padding: 5px 8px; border-radius: 6px; font-size: 12px; font-weight: 700; margin-right: 4px; margin-bottom: 4px; }
    .bg-green { background: #e6fcf5; color: #0ca678; }
    .bg-red { background: #fff5f5; color: #fa5252; }
    .bg-gray { background: #f1f3f5; color: #495057; }

    .detail { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f1f3f5; font-size: 14px; color: #495057; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    .link-btn { display: block; text-align: center; margin-top: 12px; padding: 14px; background: #f8f9fa; color: var(--primary); text-decoration: none; border-radius: 10px; font-weight: 700; transition: 0.2s; }
    
    .filter-group { display: flex; align-items: center; margin-bottom: 12px; }
    .filter-group .filter-bar { flex: 1; margin-bottom: 0; }
    .filter-group span { min-width: 35px; font-size: 14px; font-weight: 700; color: #333; margin-right: 8px;}

    .bookmark-toggle-area { display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .btn-bookmark-mode, .btn-reset-bookmark { padding: 8px 14px; border-radius: 50px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; font-size: 13px; }
    .btn-bookmark-mode { background: white; border: 1px solid #ced4da; color: #495057; }
    .btn-bookmark-mode.active { border-color: var(--star); background: #fff9db; color: #f08c00; }
    .btn-reset-bookmark { background: white; border: 1px solid #ffc9c9; color: var(--danger); }

    .sample-btn { display: block; margin: 15px auto 0; background: transparent; border: 1px solid #dee2e6; color: #868e96; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 13px; width: 100%; box-sizing: border-box; }

    #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; pointer-events: none; }
    .toast { background: rgba(33, 37, 41, 0.95); color: white; padding: 14px 20px; border-radius: 50px; font-size: 14px; font-weight: 600; margin-top: 10px; opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(20px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); text-align: center; word-break: keep-all; }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* â˜…â˜…â˜… ëª¨ë°”ì¼ ìµœì í™” ë¯¸ë””ì–´ ì¿¼ë¦¬ â˜…â˜…â˜… */
    @media (max-width: 600px) {
        body { padding: 20px 15px; }
        .container { padding-bottom: 60px; }
        
        h1 { font-size: 26px; margin-bottom: 5px; }
        .subtitle { font-size: 14px; margin-bottom: 30px; }
        
        .upload-box { padding: 30px 20px; }
        .input-box { padding: 20px; }
        
        /* ì…ë ¥ì°½ ë¼ë²¨ ê¸¸ì´ í™•ë³´ */
        .row { gap: 10px; }
        .row label { width: 45px; font-size: 15px; }
        input, select { padding: 12px; font-size: 15px; }
        
        /* í•„í„° ê·¸ë£¹ ì„¸ë¡œ ë°°ì¹˜ ëŒ€ì‹  ê°€ë¡œ ìŠ¤í¬ë¡¤ ìµœì í™” */
        .filter-group { flex-direction: column; align-items: flex-start; gap: 5px; }
        .filter-group span { margin-bottom: 5px; display: inline-block; }
        .filter-group .filter-bar { width: 100%; }
        
        .card { padding: 20px; }
        .card-header .star-btn { font-size: 28px; padding: 10px; margin: -10px -10px 0 0; } /* í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
        
        .btn-search { font-size: 16px; padding: 14px; }
        .bookmark-toggle-area { justify-content: space-between; }
        .btn-bookmark-mode, .btn-reset-bookmark { flex: 1; justify-content: center; }
    }
</style>
</head>
<body>

<div class="container">
    <h1>âš¡ï¸ ìˆ˜ì‹œ ìµœì € í•„í„°</h1>
    <p class="subtitle">ë³µì¡í•œ ëª¨ì§‘ìš”ê°•, í´ë¦­ í•œ ë²ˆìœ¼ë¡œ í•„í„°ë§</p> 
    
    <div class="upload-box" id="drop-zone">
        <h3 style="margin-top:0; font-size: 20px;">ğŸ“‚ 1ë‹¨ê³„: ì—‘ì…€ íŒŒì¼ ì—´ê¸°</h3>
        <p style="color:#868e96; font-size:14px; margin-bottom: 20px; word-break: keep-all;">í•™êµ/í•™ê³¼ë³„ ìµœì €í•™ë ¥ê¸°ì¤€ì´ ë‹´ê¸´ <b>.xlsx</b> íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:block; margin:0 auto; max-width: 100%;">
        <button class="sample-btn" onclick="loadSampleData()">ğŸ§ª ì—‘ì…€ íŒŒì¼ì´ ì—†ìœ¼ì‹ ê°€ìš”? <b>ìƒ˜í”Œ ë°ì´í„°ë¡œ ì²´í—˜í•˜ê¸°</b></button>
        <div id="file-status" style="color:#007aff; font-weight:bold; margin-top:15px; min-height:24px; font-size:14px; word-break: keep-all;"></div>
    </div>

    <div class="input-box" id="input-area">
        <h3 style="margin-top:0; margin-bottom:20px; font-size: 20px;">ğŸ“ 2ë‹¨ê³„: ë‚´ ì„±ì  ì…ë ¥</h3>
        <div class="row"><label>êµ­ì–´</label><input type="number" id="kor" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric"></div>
        <div class="row"><label>ìˆ˜í•™</label>
            <select id="mathType"><option value="ë¯¸ì _ê¸°í•˜">ë¯¸ì /ê¸°í•˜</option><option value="í™•í†µ">í™•í†µ</option></select>
            <input type="number" id="math" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric">
        </div>
        <div class="row"><label>ì˜ì–´</label><input type="number" id="eng" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric"></div>
        <div class="row"><label>íƒêµ¬1</label>
            <select id="tam1Type"><option value="ê³¼íƒ">ê³¼íƒ</option><option value="ì‚¬íƒ">ì‚¬íƒ</option></select>
            <input type="number" id="tam1" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric">
        </div>
        <div class="row"><label>íƒêµ¬2</label>
            <select id="tam2Type"><option value="ê³¼íƒ">ê³¼íƒ</option><option value="ì‚¬íƒ">ì‚¬íƒ</option></select>
            <input type="number" id="tam2" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric">
        </div>
        <div class="row"><label>í•œêµ­ì‚¬</label><input type="number" id="his" placeholder="ë“±ê¸‰" min="1" max="9" inputmode="numeric"></div>
        <button class="btn-search" onclick="runFilter()">ë¶„ì„ ì‹œì‘ ğŸš€</button>
    </div>

    <div id="result-area" style="display:none;">
    <div style="margin-bottom:20px; display:flex; flex-direction:column; gap:8px;">
        
        <div class="bookmark-toggle-area">
            <button class="btn-bookmark-mode" id="btn-bookmark-mode" onclick="toggleBookmarkMode()">
                <span>â­</span> ì°œí•œ í•™ê³¼ë§Œ ëª¨ì•„ë³´ê¸°
            </button>
            <button class="btn-reset-bookmark" onclick="resetBookmarks()">
                <span>ğŸ—‘ï¸</span> ì°œ ì´ˆê¸°í™”
            </button>
        </div>

        <div class="filter-group">
            <span>ìµœì €</span>
            <div class="filter-bar" id="limit-filter">
                <button class="filter-btn active" data-filter-type="limit" data-filter-value="all" onclick="multiFilter(this)">ì „ì²´</button>
                <button class="filter-btn" data-filter-type="limit" data-filter-value="yes" onclick="multiFilter(this)">ìµœì € ìˆìŒ</button>
                <button class="filter-btn" data-filter-type="limit" data-filter-value="no" onclick="multiFilter(this)">ìµœì € ì—†ìŒ</button>
            </div>
        </div>
        
        <div class="filter-group">
            <span>ê³„ì—´</span>
            <div class="filter-bar" id="category-filter">
                <button class="filter-btn active" data-filter-type="category" data-filter-value="all" onclick="multiFilter(this)">ì „ì²´</button>
            </div>
        </div>

        <div class="filter-group">
            <span>í•™êµ</span>
            <div class="filter-bar" id="univ-filter">
                <button class="filter-btn active" data-filter-type="univ" data-filter-value="all" onclick="multiFilter(this)">ì „ì²´</button>
            </div>
        </div>
        
        <div class="filter-group">
            <span>ì „í˜•</span>
            <div class="filter-bar" id="type-filter">
                <button class="filter-btn active" data-filter-type="type" data-filter-value="all" onclick="multiFilter(this)">ì „ì²´</button>
            </div>
        </div>
        
        <span id="count-text" style="font-weight:800; color:#495057; text-align:right; font-size: 15px; margin-top: 5px;"></span>
    </div>
    <div id="list"></div>
</div>

<div id="toast-container"></div>

<script>
    let db = []; 
    let filteredDb = []; 
    let bookmarks = new Set(); 
    let isBookmarkMode = false; 
    let lastUserScore = null; 
    
    let currentFilters = { 
        univ: 'all', 
        category: 'all', 
        type: 'all', 
        limit: 'all' 
    };

    const UNIV_COLORS = {
        "ì„œìš¸ëŒ€": "#0F0F70", "ì—°ì„¸ëŒ€": "#00287A", "ê³ ë ¤ëŒ€": "#860018",
        "ì„œê°•ëŒ€": "#B0232A", "ì„±ê· ê´€ëŒ€": "#003E33", "í•œì–‘ëŒ€": "#0E4194",
        "ì¤‘ì•™ëŒ€": "#183E93", "ê²½í¬ëŒ€": "#9D2235", "ì„œìš¸ì‹œë¦½ëŒ€": "#16469E",
        "ê±´êµ­ëŒ€": "#00452E", "ê²½ë¶ëŒ€": "#DD2417", "ë¶€ì‚°ëŒ€": "#00578E"
    };

    const RANKED_UNIVS = [
        "ì„œìš¸ëŒ€", "ì—°ì„¸ëŒ€", "ê³ ë ¤ëŒ€", "ì„œê°•ëŒ€", "ì„±ê· ê´€ëŒ€", "í•œì–‘ëŒ€", 
        "ì¤‘ì•™ëŒ€", "ê²½í¬ëŒ€", "ì„œìš¸ì‹œë¦½ëŒ€", "ê±´êµ­ëŒ€", "ê²½ë¶ëŒ€", "ë¶€ì‚°ëŒ€"
    ];

    const RANKED_TYPES = ["êµê³¼", "ì¢…í•©", "ë…¼ìˆ ", "ê¸°íƒ€"];
    const TYPE_DISPLAY_NAMES = { "êµê³¼": "í•™ìƒë¶€ êµê³¼", "ì¢…í•©": "í•™ìƒë¶€ ì¢…í•©", "ë…¼ìˆ ": "ë…¼ìˆ ", "ê¸°íƒ€": "ê¸°íƒ€" };

    try {
        const saved = localStorage.getItem('sky_bookmarks');
        if(saved) bookmarks = new Set(JSON.parse(saved));
    } catch(e) {}

    function showToast(message) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerText = message;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function loadSampleData() {
        const sample = [
            {ëŒ€í•™ëª…:"ì„œìš¸ëŒ€", ê³„ì—´:"ì¸ë¬¸", ëª¨ì§‘ë‹¨ìœ„:"ê²½ì˜ëŒ€í•™", ì „í˜•ëª…:"ì§€ì—­ê· í˜•", ì „í˜•ë¶„ë¥˜:"êµê³¼", ë“±ê¸‰í•©:9, ë°˜ì˜ì˜ì—­ìˆ˜:3, íƒêµ¬ë°˜ì˜ìˆ˜:2, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"", íƒêµ¬ì„ íƒ:"", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"https://admission.snu.ac.kr", '50ì»·':"1.1", '70ì»·':"1.2"},
            {ëŒ€í•™ëª…:"ì„œìš¸ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ì˜ì˜ˆê³¼", ì „í˜•ëª…:"ì¼ë°˜ì „í˜•", ì „í˜•ë¶„ë¥˜:"ì¢…í•©", ë“±ê¸‰í•©:0, ë°˜ì˜ì˜ì—­ìˆ˜:0, íƒêµ¬ë°˜ì˜ìˆ˜:2, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"ë¯¸ì ", íƒêµ¬ì„ íƒ:"ê³¼íƒ", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"1.0", '70ì»·':"1.1"},
            {ëŒ€í•™ëª…:"ì—°ì„¸ëŒ€", ê³„ì—´:"ì¸ë¬¸", ëª¨ì§‘ë‹¨ìœ„:"ê²½ì œí•™ë¶€", ì „í˜•ëª…:"í™œë™ìš°ìˆ˜í˜•", ì „í˜•ë¶„ë¥˜:"ì¢…í•©", ë“±ê¸‰í•©:4, ë°˜ì˜ì˜ì—­ìˆ˜:2, íƒêµ¬ë°˜ì˜ìˆ˜:1, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"", íƒêµ¬ì„ íƒ:"", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"3ë“±ê¸‰", URL:"", '50ì»·':"1.4", '70ì»·':"1.6"},
            {ëŒ€í•™ëª…:"ê³ ë ¤ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ì»´í“¨í„°í•™ê³¼", ì „í˜•ëª…:"í•™êµì¶”ì²œ", ì „í˜•ë¶„ë¥˜:"êµê³¼", ë“±ê¸‰í•©:7, ë°˜ì˜ì˜ì—­ìˆ˜:3, íƒêµ¬ë°˜ì˜ìˆ˜:2, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"ë¯¸ì ", íƒêµ¬ì„ íƒ:"ê³¼íƒ", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"1.3", '70ì»·':"1.5"},
            {ëŒ€í•™ëª…:"í•œì–‘ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ê¸°ê³„ê³µí•™ë¶€", ì „í˜•ëª…:"ë…¼ìˆ ì „í˜•", ì „í˜•ë¶„ë¥˜:"ë…¼ìˆ ", ë“±ê¸‰í•©:0, ë°˜ì˜ì˜ì—­ìˆ˜:0, íƒêµ¬ë°˜ì˜ìˆ˜:0, í•œêµ­ì‚¬:0, ìˆ˜í•™ì„ íƒ:"", íƒêµ¬ì„ íƒ:"", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"-", '70ì»·':"-"},
            {ëŒ€í•™ëª…:"ì¤‘ì•™ëŒ€", ê³„ì—´:"ì¸ë¬¸", ëª¨ì§‘ë‹¨ìœ„:"ê²½ì˜í•™ë¶€", ì „í˜•ëª…:"ë…¼ìˆ ì „í˜•", ì „í˜•ë¶„ë¥˜:"ë…¼ìˆ ", ë“±ê¸‰í•©:6, ë°˜ì˜ì˜ì—­ìˆ˜:3, íƒêµ¬ë°˜ì˜ìˆ˜:1, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"", íƒêµ¬ì„ íƒ:"", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"-", '70ì»·':"-"},
            {ëŒ€í•™ëª…:"ì„±ê· ê´€ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ì „ìì „ê¸°ê³µí•™ë¶€", ì „í˜•ëª…:"ë…¼ìˆ ìš°ìˆ˜", ì „í˜•ë¶„ë¥˜:"ë…¼ìˆ ", ë“±ê¸‰í•©:5, ë°˜ì˜ì˜ì—­ìˆ˜:3, íƒêµ¬ë°˜ì˜ìˆ˜:2, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"ë¯¸ì ", íƒêµ¬ì„ íƒ:"ê³¼íƒ", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"2ë“±ê¸‰", URL:"", '50ì»·':"-", '70ì»·':"-"},
            {ëŒ€í•™ëª…:"ê²½í¬ëŒ€", ê³„ì—´:"ì¸ë¬¸", ëª¨ì§‘ë‹¨ìœ„:"í˜¸í…”ê²½ì˜í•™ê³¼", ì „í˜•ëª…:"ë„¤ì˜¤ë¥´ë„¤ìƒìŠ¤", ì „í˜•ë¶„ë¥˜:"ì¢…í•©", ë“±ê¸‰í•©:0, ë°˜ì˜ì˜ì—­ìˆ˜:0, íƒêµ¬ë°˜ì˜ìˆ˜:0, í•œêµ­ì‚¬:0, ìˆ˜í•™ì„ íƒ:"", íƒêµ¬ì„ íƒ:"", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"2.1", '70ì»·':"2.4"},
            {ëŒ€í•™ëª…:"ê±´êµ­ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ìˆ˜ì˜ì˜ˆê³¼", ì „í˜•ëª…:"KUë…¼ìˆ ", ì „í˜•ë¶„ë¥˜:"ë…¼ìˆ ", ë“±ê¸‰í•©:4, ë°˜ì˜ì˜ì—­ìˆ˜:3, íƒêµ¬ë°˜ì˜ìˆ˜:1, í•œêµ­ì‚¬:5, ìˆ˜í•™ì„ íƒ:"ë¯¸ì ", íƒêµ¬ì„ íƒ:"ê³¼íƒ", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"-", '70ì»·':"-"},
            {ëŒ€í•™ëª…:"ë¶€ì‚°ëŒ€", ê³„ì—´:"ìì—°", ëª¨ì§‘ë‹¨ìœ„:"ê¸°ê³„ê³µí•™ë¶€", ì „í˜•ëª…:"í•™ìƒë¶€êµê³¼", ì „í˜•ë¶„ë¥˜:"êµê³¼", ë“±ê¸‰í•©:6, ë°˜ì˜ì˜ì—­ìˆ˜:2, íƒêµ¬ë°˜ì˜ìˆ˜:1, í•œêµ­ì‚¬:4, ìˆ˜í•™ì„ íƒ:"ë¯¸ì ", íƒêµ¬ì„ íƒ:"ê³¼íƒ", ì˜ì–´í•„ìˆ˜ì—¬ë¶€:"", URL:"", '50ì»·':"1.9", '70ì»·':"2.1"}
        ];
        
        db = sample;
        document.getElementById('file-status').innerHTML = `âœ… <span style="color:#007aff">ìƒ˜í”Œ ë°ì´í„°(10ê°œ)ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!</span>`;
        document.querySelector('.upload-box').classList.add('ready');
        document.getElementById('input-area').classList.add('active');
        document.getElementById('input-area').scrollIntoView({behavior: 'smooth'});
        showToast("ğŸ§ª ìƒ˜í”Œ ë°ì´í„°ë¡œ ì²´í—˜ ëª¨ë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤!");
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const rawData = XLSX.utils.sheet_to_json(worksheet);
            
            db = rawData.map(item => {
                const newItem = {};
                for(let key in item) {
                    let cleanKey = key.trim().replace(/[\ufeff\s]/g, ''); 
                    newItem[cleanKey] = item[key];
                }
                return newItem;
            });

            if(db.length > 0) {
                document.getElementById('file-status').innerText = `âœ… ${db.length}ê°œ í•™ê³¼ ë°ì´í„° ë¡œë“œ ì„±ê³µ!`;
                document.getElementById('file-status').style.color = "#007aff";
                document.querySelector('.upload-box').classList.add('ready');
                document.getElementById('input-area').classList.add('active'); 
                showToast("ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                showToast("âš ï¸ ë°ì´í„°ê°€ ì—†ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.");
            }
        };
        reader.readAsArrayBuffer(file);
    });

    function fixUrl(url, univName) {
        if (!url || url.length < 5) return "#";
        let fixed = url.trim();
        if (univName === 'ê³ ë ¤ëŒ€' && fixed.startsWith("http:")) {
            fixed = fixed.replace("http:", "https:");
        }
        return fixed;
    }

    function checkGradePass(item, u) {
        if(parseInt(item['í•œêµ­ì‚¬']) > 0 && u.his > parseInt(item['í•œêµ­ì‚¬'])) return false;
        if((item['ìˆ˜í•™ì„ íƒ']||'').includes('ë¯¸ì ') && u.mathType !== 'ë¯¸ì _ê¸°í•˜') return false;
        if((item['íƒêµ¬ì„ íƒ']||'').includes('ê³¼íƒ')) {
            if(u.tam1Type !== 'ê³¼íƒ' || u.tam2Type !== 'ê³¼íƒ') return false;
        }

        let curEng = u.eng;
        if(String(item['ì˜ì–´í•„ìˆ˜ì—¬ë¶€']).includes('ë“±ê¸‰')) {
            let limit = parseInt(item['ì˜ì–´í•„ìˆ˜ì—¬ë¶€'].replace(/[^0-9]/g,''));
            if(u.eng > limit) return false;
            if(item['ëŒ€í•™ëª…'] === 'ì—°ì„¸ëŒ€') curEng = 99; 
        }
        
        const limitSum = parseInt(item['ë“±ê¸‰í•©'] || 0);
        const limitCount = parseInt(item['ë°˜ì˜ì˜ì—­ìˆ˜'] || 0);

        if(limitSum > 0) {
            let tam = (parseInt(item['íƒêµ¬ë°˜ì˜ìˆ˜']) == 2) ? Math.floor((u.tam1+u.tam2)/2) : Math.min(u.tam1, u.tam2);
            let subs = [u.kor, u.math, tam];
            if(curEng !== 99) subs.push(curEng);
            subs.sort((a,b)=>a-b);
            let sum = 0;
            for(let i=0; i<limitCount; i++) sum += subs[i];
            if(sum > limitSum) return false;
        }
        return true;
    }

    function runFilter() {
        const rawInputs = {
            kor: document.getElementById('kor').value,
            math: document.getElementById('math').value,
            eng: document.getElementById('eng').value,
            tam1: document.getElementById('tam1').value,
            tam2: document.getElementById('tam2').value,
            his: document.getElementById('his').value
        };

        if(!rawInputs.kor || !rawInputs.math || !rawInputs.eng || !rawInputs.tam1 || !rawInputs.tam2 || !rawInputs.his) { 
            showToast("âš ï¸ ëª¨ë“  ë“±ê¸‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); 
            return; 
        }

        const u = {
            kor: Number(rawInputs.kor),
            math: Number(rawInputs.math),
            eng: Number(rawInputs.eng),
            tam1: Number(rawInputs.tam1),
            tam2: Number(rawInputs.tam2),
            his: Number(rawInputs.his),
            mathType: document.getElementById('mathType').value,
            tam1Type: document.getElementById('tam1Type').value,
            tam2Type: document.getElementById('tam2Type').value
        };

        const allGrades = [u.kor, u.math, u.eng, u.tam1, u.tam2, u.his];
        if (!allGrades.every(grade => grade >= 1 && grade <= 9)) {
            showToast("ğŸš« ë“±ê¸‰ì€ 1~9 ì‚¬ì´ì˜ ìˆ«ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return;
        }

        lastUserScore = u; 
        filteredDb = []; 
        const uniqueUnivs = new Set();
        const uniqueCategories = new Set();
        const uniqueTypes = new Set(); 
        
        db.forEach(item => {
            if(checkGradePass(item, u)) {
                filteredDb.push(item);
                if(item['ëŒ€í•™ëª…']) uniqueUnivs.add(item['ëŒ€í•™ëª…']);
                if(item['ê³„ì—´']) uniqueCategories.add(item['ê³„ì—´']);
                if(item['ì „í˜•ë¶„ë¥˜']) uniqueTypes.add(item['ì „í˜•ë¶„ë¥˜']); 
            }
        });

        createUnivFilterButtons(Array.from(uniqueUnivs)); 
        createFilterButtons('category-filter', Array.from(uniqueCategories), 'category'); 
        createTypeFilterButtons(Array.from(uniqueTypes)); 
        
        document.getElementById('result-area').style.display = 'block';
        
        currentFilters = { univ: 'all', category: 'all', type: 'all', limit: 'all' };
        isBookmarkMode = false; 
        document.getElementById('btn-bookmark-mode').classList.remove('active');
        document.getElementById('btn-bookmark-mode').innerHTML = `<span>â­</span> ì°œí•œ í•™ê³¼ë§Œ ëª¨ì•„ë³´ê¸°`;
        
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#univ-filter [data-filter-value="all"]').classList.add('active');
        document.querySelector('#category-filter [data-filter-value="all"]').classList.add('active');
        document.querySelector('#type-filter [data-filter-value="all"]').classList.add('active');
        document.querySelector('#limit-filter [data-filter-value="all"]').classList.add('active');

        updateFilterButtonsState();
        renderList(filteredDb);
        document.getElementById('count-text').innerText = `ğŸ‰ ${filteredDb.length}ê°œì˜ í•™ê³¼ ë°œê²¬!`;
        
        setTimeout(() => document.getElementById('result-area').scrollIntoView({behavior: 'smooth'}), 100);
    }

    function createUnivFilterButtons(values) {
        const bar = document.getElementById('univ-filter');
        Array.from(bar.children).forEach(child => {
            if (child.getAttribute('data-filter-value') !== 'all') bar.removeChild(child);
        });
        
        values.sort((a, b) => {
            const indexA = RANKED_UNIVS.indexOf(a);
            const indexB = RANKED_UNIVS.indexOf(b);
            if (indexA === -1 && indexB === -1) return a.localeCompare(b);
            if (indexA === -1) return 1;
            if (indexB === -1) return -1;
            return indexA - indexB;
        });

        values.forEach(value => {
            let btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.textContent = value;
            btn.dataset.filterType = 'univ';
            btn.dataset.filterValue = value;
            btn.onclick = function() { multiFilter(this); };
            bar.appendChild(btn);
        });
    }

    function createFilterButtons(parentId, values, filterType) {
        const bar = document.getElementById(parentId);
        Array.from(bar.children).forEach(child => {
            if (child.getAttribute('data-filter-value') !== 'all') bar.removeChild(child);
        });
        values.sort().forEach(value => {
            let btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.textContent = value;
            btn.dataset.filterType = filterType;
            btn.dataset.filterValue = value;
            btn.onclick = function() { multiFilter(this); };
            bar.appendChild(btn);
        });
    }

    function createTypeFilterButtons(values) {
        const bar = document.getElementById('type-filter');
        Array.from(bar.children).forEach(child => {
            if (child.getAttribute('data-filter-value') !== 'all') bar.removeChild(child);
        });

        values.sort((a, b) => {
            const indexA = RANKED_TYPES.indexOf(a);
            const indexB = RANKED_TYPES.indexOf(b);
            if (indexA === -1 && indexB === -1) return a.localeCompare(b);
            if (indexA === -1) return 1;
            if (indexB === -1) return -1;
            return indexA - indexB;
        });

        values.forEach(value => {
            let btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.textContent = TYPE_DISPLAY_NAMES[value] || value;
            btn.dataset.filterType = 'type';
            btn.dataset.filterValue = value; 
            btn.onclick = function() { multiFilter(this); };
            bar.appendChild(btn);
        });
    }

    function toggleBookmarkMode() {
        isBookmarkMode = !isBookmarkMode;
        const btn = document.getElementById('btn-bookmark-mode');
        
        if(isBookmarkMode) {
            btn.classList.add('active');
            btn.innerHTML = `<span>â­</span> ì „ì²´ ë³´ê¸°`;
            showToast("â­ ì°œí•œ í•™ê³¼ë§Œ ëª¨ì•„ë´…ë‹ˆë‹¤.");
        } else {
            btn.classList.remove('active');
            btn.innerHTML = `<span>â­</span> ì°œí•œ í•™ê³¼ë§Œ ëª¨ì•„ë³´ê¸°`;
            showToast("ğŸ“‚ ì „ì²´ ëª©ë¡ìœ¼ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤.");
        }
        applyFiltersAndRender(); 
    }

    function toggleBookmark(key) {
        if(bookmarks.has(key)) {
            bookmarks.delete(key);
        } else {
            bookmarks.add(key);
            showToast("â­ ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }
        localStorage.setItem('sky_bookmarks', JSON.stringify(Array.from(bookmarks)));
        applyFiltersAndRender();
    }

    function resetBookmarks() {
        if(bookmarks.size === 0) {
            showToast("ì‚­ì œí•  ì°œ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        if(confirm("ì •ë§ ëª¨ë“  ì°œ ëª©ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            bookmarks.clear();
            localStorage.removeItem('sky_bookmarks');
            applyFiltersAndRender();
            showToast("ğŸ—‘ï¸ ì°œ ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    }

    function updateFilterButtonsState() {
        if (isBookmarkMode) return; 

        const filterTypes = ['univ', 'category', 'type', 'limit'];
        filterTypes.forEach(targetType => {
            const container = document.getElementById(`${targetType}-filter`);
            if (!container) return;
            const buttons = container.querySelectorAll('.filter-btn');

            const validData = filteredDb.filter(item => {
                let match = true;
                if (targetType !== 'univ' && currentFilters.univ !== 'all' && item['ëŒ€í•™ëª…'] !== currentFilters.univ) match = false;
                if (targetType !== 'category' && currentFilters.category !== 'all' && item['ê³„ì—´'] !== currentFilters.category) match = false;
                if (targetType !== 'type' && currentFilters.type !== 'all' && item['ì „í˜•ë¶„ë¥˜'] !== currentFilters.type) match = false;
                if (targetType !== 'limit') {
                    if (currentFilters.limit === 'yes' && (parseInt(item['ë“±ê¸‰í•©'] || 0) === 0)) match = false;
                    if (currentFilters.limit === 'no' && (parseInt(item['ë“±ê¸‰í•©'] || 0) > 0)) match = false;
                }
                return match;
            });

            const availableValues = new Set();
            validData.forEach(item => {
                if (targetType === 'univ') availableValues.add(item['ëŒ€í•™ëª…']);
                else if (targetType === 'category') availableValues.add(item['ê³„ì—´']);
                else if (targetType === 'type') availableValues.add(item['ì „í˜•ë¶„ë¥˜']); 
                else if (targetType === 'limit') {
                    const hasLimit = parseInt(item['ë“±ê¸‰í•©'] || 0) > 0;
                    availableValues.add(hasLimit ? 'yes' : 'no');
                }
            });

            buttons.forEach(btn => {
                const val = btn.dataset.filterValue;
                if (val === 'all') return;
                if (availableValues.has(val)) btn.style.display = 'inline-block';
                else btn.style.display = 'none';
            });
        });
    }

    function multiFilter(btn) {
        const filterType = btn.dataset.filterType;
        const filterValue = btn.dataset.filterValue;

        document.querySelectorAll(`[data-filter-type="${filterType}"]`).forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        currentFilters[filterType] = filterValue;
        updateFilterButtonsState();
        applyFiltersAndRender();
    }

    function applyFiltersAndRender() {
        let finalResult = [];

        if (isBookmarkMode) {
            db.forEach(item => {
                const uniqueKey = `${item['ëŒ€í•™ëª…']}_${item['ëª¨ì§‘ë‹¨ìœ„']}_${item['ì „í˜•ëª…']}`;
                if (bookmarks.has(uniqueKey)) {
                    const passed = lastUserScore ? checkGradePass(item, lastUserScore) : true;
                    const displayItem = { ...item, _isFailed: !passed };
                    finalResult.push(displayItem);
                }
            });
        } else {
            finalResult = filteredDb.filter(item => {
                const univMatch = currentFilters.univ === 'all' || item['ëŒ€í•™ëª…'] === currentFilters.univ;
                const categoryMatch = currentFilters.category === 'all' || item['ê³„ì—´'] === currentFilters.category;
                const typeMatch = currentFilters.type === 'all' || item['ì „í˜•ë¶„ë¥˜'] === currentFilters.type;
                
                let limitMatch = true;
                if (currentFilters.limit === 'yes') limitMatch = parseInt(item['ë“±ê¸‰í•©'] || 0) > 0;
                else if (currentFilters.limit === 'no') limitMatch = parseInt(item['ë“±ê¸‰í•©'] || 0) === 0;
                
                return univMatch && categoryMatch && typeMatch && limitMatch;
            });
        }

        renderList(finalResult);
        const countMsg = isBookmarkMode ? `â­ ì°œí•œ í•™ê³¼ ${finalResult.length}ê°œ` : `ğŸ‰ ${finalResult.length}ê°œì˜ í•™ê³¼ ë°œê²¬!`;
        document.getElementById('count-text').innerText = countMsg;
    }

    function renderList(data) {
        const list = document.getElementById('list');
        list.innerHTML = '';
        
        data.forEach(item => {
            const univ = item['ëŒ€í•™ëª…'] || '';
            const dept = item['ëª¨ì§‘ë‹¨ìœ„'] || '';
            const typeName = item['ì „í˜•ëª…'] || ''; 
            
            const limitSum = parseInt(item['ë“±ê¸‰í•©'] || 0);
            const limitCount = parseInt(item['ë°˜ì˜ì˜ì—­ìˆ˜'] || 0);
            const url = item['URL'];
            
            let finalLink = fixUrl(url, univ);
            let borderColor = UNIV_COLORS[univ] || '#dee2e6';

            const uniqueKey = `${univ}_${dept}_${typeName}`;
            const isBookmarked = bookmarks.has(uniqueKey);
            const isFailed = item._isFailed || false; 

            let d = document.createElement('div');
            d.className = `card item ${isFailed ? 'dimmed' : ''}`;
            d.dataset.univ = univ;
            d.style.borderLeftColor = borderColor;
            
            d.innerHTML = `
                <div class="card-header">
                    <div>
                        <div style="font-size:13px; color:#868e96; margin-bottom:4px;">${univ} Â· ${item['ê³„ì—´']}</div>
                        <div style="font-size:19px; font-weight:800; color:#212529;">${dept}</div>
                    </div>
                    <span class="star-btn ${isBookmarked ? 'active' : ''}" onclick="event.stopPropagation(); toggleBookmark('${uniqueKey}')">
                        ${isBookmarked ? 'â˜…' : 'â˜†'}
                    </span>
                </div>
                <div style="margin-top:12px;">
                    <span class="badge bg-gray">${typeName}</span>
                    ${limitSum > 0 ? `<span class="badge bg-red">ìµœì € ${limitCount}í•© ${limitSum}</span>` : ''}
                    <span class="fail-msg">âš ï¸ ê¸°ì¤€ ë¯¸ë‹¬</span>
                </div>
                <div class="detail">
                    <p style="margin: 0;">ì‘ë…„ 50%ì»·: <b>${item['50ì»·'] || '-'}</b> / 70%ì»·: <b>${item['70ì»·'] || '-'}</b></p>
                    <a href="${finalLink}" target="_blank" class="link-btn">í•™ê³¼ í™ˆí˜ì´ì§€ ë°”ë¡œê°€ê¸° ></a>
                </div>
            `;
            d.onclick = function(e) {
                if(e.target.tagName !== 'A' && !e.target.classList.contains('star-btn')) {
                    let det = this.querySelector('.detail');
                    const isHidden = getComputedStyle(det).display === 'none';
                    det.style.display = isHidden ? 'block' : 'none';
                }
            };
            list.appendChild(d);
        });
    }
</script>
</body>
</html>
